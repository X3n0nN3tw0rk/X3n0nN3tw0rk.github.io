<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Embed Gallery</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #0f0f0f;
        margin: 0;
        padding: 40px;
        color: white;
    }

    h1 {
        text-align: center;
        font-size: 36px;
        margin-bottom: 30px;
    }

    .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 25px;
    }

    .card {
        background: #1b1b1b;
        border-radius: 16px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 0 20px rgba(0,0,0,0.4);
        transition: 0.3s;
    }

    .card:hover {
        transform: scale(1.02);
        box-shadow: 0 0 25px rgba(0,0,0,0.7);
    }

    .preview-wrapper {
        width: 100%;
        height: 200px;
        background: #111;
        position: relative;
    }

    iframe {
        width: 100%;
        height: 100%;
        border: none;
        background: black;
    }

    .fallback-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: none;
    }

    .title {
        font-size: 20px;
        padding: 15px;
        font-weight: bold;
    }

    .menu-btn {
        position: absolute;
        top: 8px;
        right: 10px;
        background: rgba(0,0,0,0.6);
        border: none;
        color: white;
        font-size: 22px;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        cursor: pointer;
    }

    .menu-panel {
        position: absolute;
        right: 10px;
        top: 45px;
        background: #222;
        padding: 12px;
        border-radius: 10px;
        display: none;
        flex-direction: column;
        gap: 8px;
        z-index: 99;
    }

    .menu-panel input {
        width: 200px;
        padding: 6px;
        border-radius: 6px;
        border: 1px solid #555;
        background: #111;
        color: white;
    }

    .save-btn {
        background: #00aaff;
        color: black;
        border: none;
        padding: 8px;
        border-radius: 6px;
        cursor: pointer;
    }
</style>
</head>
<body>

<h1>Website Embed Portfolio</h1>
<div class="gallery" id="gallery"></div>

<script>
let sites = JSON.parse(localStorage.getItem("embedSites")) || [
    { name: "", url: "", img: "" },
    { name: "", url: "", img: "" },
    { name: "", url: "", img: "" }
];

// SAVE
function save() {
    localStorage.setItem("embedSites", JSON.stringify(sites));
}

// BUILD CARDS
function render() {
    const gallery = document.getElementById("gallery");
    gallery.innerHTML = "";

    sites.forEach((site, index) => {
        let card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
            <div class="preview-wrapper">
                <iframe src="${site.url}" data-index="${index}" onload="checkEmbed(event)"></iframe>
                <img src="${site.img}" class="fallback-img" id="fallback-${index}">
                <button class="menu-btn" onclick="toggleMenu(${index})">⋮</button>

                <div class="menu-panel" id="menu-${index}">
                    <input placeholder="Website Name" value="${site.name}" id="name-${index}">
                    <input placeholder="Embed URL" value="${site.url}" id="url-${index}">
                    <input placeholder="Preview Image URL" value="${site.img}" id="img-${index}">
                    <button class="save-btn" onclick="updateSite(${index})">Save</button>
                </div>
            </div>
            <div class="title">${site.name || "Unnamed Site"}</div>
        `;

        gallery.appendChild(card);
    });
}

// TOGGLE MENU
function toggleMenu(i) {
    const menu = document.getElementById("menu-" + i);
    menu.style.display = menu.style.display === "flex" ? "none" : "flex";
}

// SAVE CHANGES
function updateSite(i) {
    sites[i].name = document.getElementById("name-" + i).value;
    sites[i].url = document.getElementById("url-" + i).value;
    sites[i].img = document.getElementById("img-" + i).value;
    save();
    render();
}

// EMBED CHECKER (detects CSP blocks)
function checkEmbed(e) {
    let iframe = e.target;
    let index = iframe.getAttribute("data-index");

    try {
        // Attempt to access iframe → throws error if blocked
        let test = iframe.contentWindow.location.href;
    } catch (err) {
        iframe.style.display = "none";
        document.getElementById("fallback-" + index).style.display = "block";
    }
}

render();
</script>

</body>
</html>
