<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Embed Portfolio Gallery</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #0f0f0f;
        margin: 0;
        padding: 40px;
        color: white;
    }

    h1 {
        text-align: center;
        font-size: 36px;
        margin-bottom: 30px;
    }

    .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 25px;
    }

    .card {
        background: #1b1b1b;
        border-radius: 16px;
        overflow: hidden;
        position: relative;
        cursor: pointer;
        transition: 0.3s;
    }

    .card:hover {
        transform: scale(1.03);
        box-shadow: 0 0 25px rgba(0,0,0,0.5);
    }

    /* Preview box */
    .preview-area {
        width: 100%;
        height: 150px;
        background: #111;
        overflow: hidden;
        position: relative;
    }

    .preview-iframe {
        width: 400%;
        height: 400%;
        transform: scale(0.25);
        transform-origin: top left;
        border: none;
        pointer-events: none; /* Disable interaction in preview */
    }

    .preview-img {
        width: 100%;
        height: 100%;
        display: none;
        object-fit: cover;
    }

    .title {
        padding: 12px;
        font-weight: bold;
        font-size: 18px;
    }

    .menu-btn {
        position: absolute;
        top: 8px;
        right: 10px;
        background: rgba(0,0,0,0.6);
        border: none;
        color: white;
        font-size: 20px;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        cursor: pointer;
        z-index: 10;
    }

    .menu-panel {
        position: absolute;
        right: 10px;
        top: 45px;
        background: #222;
        padding: 12px;
        border-radius: 10px;
        display: none;
        flex-direction: column;
        gap: 8px;
        z-index: 20;
    }

    .menu-panel input {
        width: 200px;
        padding: 6px;
        border-radius: 6px;
        border: 1px solid #555;
        background: #111;
        color: white;
    }

    .save-btn {
        background: #00aaff;
        color: black;
        border: none;
        padding: 8px;
        border-radius: 6px;
        cursor: pointer;
    }

    /* FULL-SCREEN VIEWER */
    #viewer {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: black;
        display: none;
        flex-direction: column;
    }

    #viewer iframe {
        width: 100%;
        height: 100%;
        border: none;
    }

    #backBtn {
        position: absolute;
        top: 20px;
        left: 20px;
        background: white;
        color: black;
        padding: 10px 16px;
        border-radius: 8px;
        cursor: pointer;
        z-index: 50;
        font-size: 16px;
        border: none;
    }

    #viewerFallback {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: none;
    }
</style>
</head>
<body>

<h1>Website Embed Portfolio</h1>

<div class="gallery" id="gallery"></div>

<!-- FULLSCREEN VIEWER -->
<div id="viewer">
    <button id="backBtn" onclick="closeViewer()">← Back</button>
    <iframe id="viewerFrame"></iframe>
    <img id="viewerFallback">
</div>

<script>
let sites = JSON.parse(localStorage.getItem("embedSites")) || [
    { name: "", url: "", img: "" },
    { name: "", url: "", img: "" },
    { name: "", url: "", img: "" }
];

function save() {
    localStorage.setItem("embedSites", JSON.stringify(sites));
}

function render() {
    const gallery = document.getElementById("gallery");
    gallery.innerHTML = "";

    sites.forEach((site, i) => {
        let c = document.createElement("div");
        c.className = "card";

        c.innerHTML = `
            <div class="preview-area" onclick="openViewer(${i})">
                <iframe class="preview-iframe" src="${site.url}" data-i="${i}" onload="checkPreview(event)"></iframe>
                <img id="pimg-${i}" class="preview-img" src="${site.img}">
                <button class="menu-btn" onclick="event.stopPropagation();toggleMenu(${i})">⋮</button>
                <div class="menu-panel" id="menu-${i}">
                    <input id="name-${i}" placeholder="Website Name" value="${site.name}">
                    <input id="url-${i}" placeholder="Embed URL" value="${site.url}">
                    <input id="img-${i}" placeholder="Preview Image URL" value="${site.img}">
                    <button class="save-btn" onclick="updateSite(${i})">Save</button>
                </div>
            </div>
            <div class="title">${site.name || "Unnamed Site"}</div>
        `;

        gallery.appendChild(c);
    });
}

function toggleMenu(i) {
    let m = document.getElementById("menu-" + i);
    m.style.display = m.style.display === "flex" ? "none" : "flex";
}

function updateSite(i) {
    sites[i].name = document.getElementById("name-" + i).value;
    sites[i].url  = document.getElementById("url-" + i).value;
    sites[i].img  = document.getElementById("img-" + i).value;
    save();
    render();
}

function checkPreview(e) {
    let iframe = e.target;
    let i = iframe.getAttribute("data-i");

    try { iframe.contentWindow.location.href; }
    catch (err) {
        iframe.style.display = "none";
        document.getElementById("pimg-" + i).style.display = "block";
    }
}

/* FULL SCREEN VIEWER */
function openViewer(i) {
    let viewer = document.getElementById("viewer");
    let frame = document.getElementById("viewerFrame");
    let fallback = document.getElementById("viewerFallback");

    viewer.style.display = "flex";
    fallback.style.display = "none";
    frame.style.display = "block";

    frame.src = sites[i].url;

    setTimeout(() => {
        try { frame.contentWindow.location.href; }
        catch {
            frame.style.display = "none";
            fallback.src = sites[i].img;
            fallback.style.display = "block";
        }
    }, 800);
}

function closeViewer() {
    document.getElementById("viewer").style.display = "none";
    document.getElementById("viewerFrame").src = "";
}

render();
</script>

</body>
</html>
